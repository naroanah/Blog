## 一个简单问题
有 $n$ 个人去完成一项任务，第 $i$ 个人完成任务的概率为 $p_i$，如果某人未能完成任务，则派下一个人继续，否则停止派遣。应该以怎样的顺序派遣他们，使得派遣总人数的数学期望最小？

答案是 trivial 的，显然按照 $p_i$ 从大到小排序即可。考虑证明。

!!!
    设 $f_i$ 表示在安排的顺序中，第 $i$ 个人完成任务的概率，随机变量 $X$ 表示派遣总人数。
    
    为了方便，记前 $i$ 个人都失败的概率为 $C_i = \prod\limits _{j=1} ^{i} (1-f_j)$。那么
    

    $$
    E(X)=\sum\limits_{i=1}^{n-1} i \times C_{i-1}f_i + n \times C_{n-1}
    $$

    如何证明这样的排序是最优的？使用调整法，即对于相邻的 $(i,i+1)$，如果 $f_i<f_{i+1}$，我们尝试交换它们。如果交换后更优，那么对于所有满足要求的 $(i,i+1)$，我们会不断交换下去，直到不存在这样的 $(i,i+1)$，即从大到小排序为止。这样就证明了我们的贪心排序方式是最优的。
    发现只有最后一个比较特殊，我们不考虑它，同理即可。

    交换 $(i,i+1)\,(i\le n-2,f_i<f_{i-1})$ 后：
    $$
    \begin{aligned}
        \Delta E(X) &= C_{i-1}[(if_{i+1}+(i+1)(1-f_{i+1})f_i)-(if_i+(i+1)(1-f_i)f_{i+1})] \\
        &= C_{i-1}(f_i - f_{i-1}) < 0
    \end{aligned}
    $$

    故这样的交换可以让答案更优，原命题得证。


